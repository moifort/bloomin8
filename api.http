### Base
@base = http://192.168.0.164:3000
@canvas = http://192.168.0.174
@image = 0af14d4b8ec69d21d71f4113_P.jpg

### GET eink pull (empty or photo)
GET {{base}}/eink_pull

### GET image (display immediately)
GET {{base}}/images/{{image}}
Accept: image/jpeg

### GET settings
GET {{base}}/settings

### PUT settings (valid)
PUT {{base}}/settings
Content-Type: application/json

{
  "intervalHours": 3,
  "shuffle": true
}

### POST upload image
POST {{base}}/upload?orientation=P
Content-Type: application/octet-stream

< ./tests/data/test.jpeg

### QUICK FLOW 1/3 - Verify uploaded image URL (set @image from upload response)
GET {{base}}/images/{{image}}
Accept: image/jpeg

### QUICK FLOW 2/3 - Check what the device would pull now
GET {{base}}/eink_pull

### QUICK FLOW 3/3 - Trigger canvas pull at the next wake (set UTC time close to now)
< {%
  const cronTime = new Date(Date.now() + 60 * 1000)
    .toISOString()
    .replace(/\.\d{3}Z$/, "Z")
  request.variables.set("cron_time", cronTime)
%}
PUT {{canvas}}/upstream/pull_settings
Content-Type: application/json

{
  "upstream_on": true,
  "upstream_url": "{{base}}",
  "token": "my-secret-token",
  "cron_time": "{{cron_time}}"
}

### GET image
GET {{base}}/images/{{image}}

###
GET {{canvas}}/upstream/pull_settings
