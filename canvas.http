@base = http://192.168.0.174
@upstream = http://192.168.0.164:3000
@image = test_P.jpg

### Get settings
GET {{base}}/upstream/pull_settings

### Save settings
< {%
  const cronTime = new Date(Date.now() + 60 * 1000)
    .toISOString()
    .replace(/\.\d{3}Z$/, "Z")
  request.variables.set("cron_time", cronTime)
%}
PUT {{base}}/upstream/pull_settings
Content-Type: application/json

{
  "upstream_on": true,
  "upstream_url": "{{upstream}}",
  "token": "my-secret-token",
  "cron_time": "{{cron_time}}"
}

### QUICK FLOW 1/4 - Upload image to upstream server
POST {{upstream}}/upload?filename={{image}}
Content-Type: application/octet-stream

< ./tests/data/mi.jpeg

### QUICK FLOW 2/4 - Verify image is directly reachable by the canvas
GET {{upstream}}/images/{{image}}
Accept: image/jpeg

### QUICK FLOW 3/4 - Program immediate pull on the canvas (UTC)
< {%
  const cronTime = new Date(Date.now() + 60 * 1000)
    .toISOString()
    .replace(/\.\d{3}Z$/, "Z")
  request.variables.set("cron_time", cronTime)
%}
PUT {{base}}/upstream/pull_settings
Content-Type: application/json

{
  "upstream_on": true,
  "upstream_url": "{{upstream}}",
  "token": "my-secret-token",
  "cron_time": "{{cron_time}}"
}

### QUICK FLOW 4/4 - Confirm device settings
GET {{base}}/upstream/pull_settings
